# 【耕食记】(Cuisine & Farming) 技术架构设计文档

## 1. 项目概述 (Project Overview)
**耕食记** 是一个深度整合农业种植与烹饪制作的沉浸式经营插件。它旨在通过引入“土地肥力”、“温室环境”、“实体烹饪”和“共享飨宴”等机制，将原本枯燥的挂机农业转化为需要策略经营的循环玩法。

本项目将作为独立插件开发，同时与 **EarthSpirit (地灵系统)** 和 **BiomeGifts (地域馈赠)** 深度联动。

---

## 2. 核心模块技术分析 (Technical Analysis)

### 2.1 土地肥力系统 (Soil Fertility)
**核心需求**: 每块耕地拥有独立的肥力值，动态平衡消耗与自然恢复，提供直观的视觉反馈。
**技术选型**: **PDC (PersistentDataContainer)**。数据直接绑定在区块 (Chunk) 上，性能最优且随地图保存。

*   **机制**:
    *   **消耗**: 作物生长/收割时扣除肥力。
    *   **恢复**: 
        *   **自然恢复**: 耕地在湿润状态下持续缓慢增加肥力（无需强制休耕）。
        *   **动态平衡**: 高肥力时恢复慢，低肥力时恢复快（防止极端透支）。
        *   **堆肥**: 玩家主动使用肥料（大幅恢复）。
    *   **影响**: 肥力值直接决定作物的生长速度和**品质星级**。

*   **视觉反馈 (Visuals)**:
    *   **贴图替换**: 利用 **ItemsAdder/Oraxen** 替换耕地模型。
        *   **肥沃土 (High)**: 深黑、湿润光泽。
        *   **普通土 (Mid)**: 原版材质。
        *   **贫瘠土 (Low)**: 发白、干裂、沙化。
    *   **粒子**: 肥力耗尽冒灰烟，施肥成功飘绿星。
    *   **农夫单片镜**: 佩戴特定道具时，ActionBar 显示精准数值 (🌱 肥力: 120/100)。

### 2.2 种植与选种体系 (Farming & Genetics)
**核心需求**: 引入孟德尔式遗传变异与温室微气候模拟，打破作物同质化。

#### A. 品质星级 (Star Level)
*   **星级 (1-5星)**: 决定作物作为食材的基础品质。
*   **决定因素**: 肥力、时令、温室、种子基因。

#### B. 基因与选种 (Genetics)
*   **种子属性**: 
    *   **基础生长速度**: 基因决定的快慢。
    *   **产量**: 单次收割的掉落量。
    *   **温度适应性**: 适宜生长的温度区间 (e.g. 10°C ~ 30°C)。
*   **鉴定**: 普通种子显示为“未鉴定”，放入鉴定机/使用放大镜揭示基因数据。
*   **提纯**: 优秀环境下种植 (温室+满肥力) -> 积累“生长势” -> 产出更高星级种子。
*   **杂交**:
    *   使用 **授粉架** 连接两块耕地。
    *   父本A + 父本B -> 中间产出 **新芽** (可能是高星父本，也可能是全新物种，如【金玉根】，也可能是失败品)。

#### C. 温室与微气候 (Greenhouse & Microclimate)
*   **温度计算**: `最终温度 = 环境气温(季节/群系) + 人为修正`。
*   **温室判定**: 上方有玻璃遮挡 -> 锁温 (免疫极端天气) + 聚热 (+5°C)。
*   **人为控温**:
    *   **升温**: 暖石/岩浆块 (+10°C), 灵火篝火 (+20°C)。
    *   **降温**: 蓝冰/干冰 (-10°C)。
*   **玩法**: 在冬天搭建温室并放置热源，模拟热带环境种植西瓜。

### 2.3 厨房与烹饪 (Kitchen & Cooking)
**核心需求**: 拆解烹饪流程，引入 Tier (复杂度) 与 Quality (品质) 双维度评价，增加 QTE 操作感。

#### A. 双维度评价体系
*   **菜谱复杂度 (Tier)**: 决定上限。
    *   T1 (清炒土豆丝): 上限 3星。
    *   T3 (佛跳墙): 上限 5星。
*   **成品品质 (Star Level)**: 决定实际效果。
    *   公式: `FinalStars = (食材平均星级 * 50%) + (QTE评分 * 50%)`。
    *   这意味着用垃圾食材或 QTE 失败，做出的 T3 菜肴也可能是 1星“黑暗料理”。

#### B. 厨房工作台矩阵
1.  **切菜板 (Cutting Board)**: 
    *   放置食材 -> 刀具点击 -> 播放音效 -> 产出半成品。
2.  **研磨钵/酿造坛 (Mortar / Jar)**: 
    *   处理香料/腌制食品，增加时间维度。
3.  **厨神铁锅 (Cooking Pot) - 核心交互**:
    *   **QTE 小游戏: 火候控制 (Temperature Control)**
        *   **UI**: BossBar 显示温度条 (蓝-冷 -> 绿-完美 -> 红-焦)。
        *   **机制**: 烹饪开始后温度自动上升。
        *   **操作**: 右键搅拌(降温)，加柴火(升温)。
        *   **判定**: 倒计时结束时，温度条停留在绿色区间为大成功；红色为失败(黑暗料理)；蓝色为小成功。

### 2.4 味觉图谱 (Flavor Profile)
*   **标签体系**: 【甜】、【辣】、【鲜】、【温】。
*   **作用**: 连接食材与最终料理，未来可扩展至 NPC/地灵喜好。

---

## 3. 开发优先级与路线图 (Roadmap)

### Phase 1: 基础架构 (Infrastructure)
1.  **项目搭建**: 引入 ItemsAdder, RealisticSeasons, EarthSpirit, BiomeGifts 依赖。 [x]
2.  **数据层**: 完善 `FertilityManager`，实现基于 PDC 的肥力逻辑与自然恢复算法。 [x]
3.  **物品库**: 定义基础农具、肥料、自定义耕地贴图 (High/Mid/Low)。 [x] (基础农具/肥料已完成，贴图待接入)

### Phase 2: 生产端 (Production)
1.  **种植逻辑**: 监听 `BlockGrowEvent`，接入肥力、季节、温室温度判定。 [x] (肥力判定已完成)
2.  **视觉反馈**: 实现耕地材质随肥力动态切换逻辑。 [-] (农夫单片镜已完成，材质切换待办)
3.  **选种与杂交**: 开发种子 NBT 基因存储、鉴定机 UI、授粉架逻辑。 [ ]

### Phase 3: 加工端 (Processing)
1.  **工作台**: 实现切菜板与研磨钵的交互逻辑。 [ ]
2.  **烹饪核心**: 开发厨神铁锅实体交互，实现 BossBar 火候控制 QTE。 [ ]
3.  **评价系统**: 实现基于“食材+QTE”的双维度成品星级计算。 [ ]

---

## 4. 技术栈确认 (Tech Stack Decisions)

*   **资源包/模型**: **ItemsAdder** (必须，用于自定义耕地贴图、厨具模型、菜肴模型)。
*   **季节系统**: **RealisticSeasons** (API Hook，获取环境温度)。
*   **数据存储**: **PDC (PersistentDataContainer)** (用于区块肥力数据)。
*   **核心依赖**: EarthSpirit, BiomeGifts, ProtocolLib.

---

**文档维护人**: Trae
**更新日期**: 2025-12-20
