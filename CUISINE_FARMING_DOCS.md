# 耕食记 (CuisineFarming) 操作文档

## 1. 系统概述 (Overview)
**耕食记** 是一个深度整合农业种植与烹饪制作的沉浸式经营插件。目前阶段核心实现了 **动态肥力系统** 与 **孟德尔基因系统**，将原本简单的“播种-收割”循环转化为需要维护土地肥力、合理施肥、并进行基因选育的深度策略性玩法。

系统通过 **PDC (PersistentDataContainer)** 技术将肥力与基因数据直接绑定在区块上，实现了高性能的数据存储与动态恢复逻辑。

---

## 2. 核心架构 (Core Architecture)

| 模块 | 类文件 | 职责 |
| :--- | :--- | :--- |
| **插件核心** | `CuisineFarming.java` | 插件入口，负责管理器初始化、命令注册与任务调度。 |
| **肥力核心** | `FertilityManager.java` | **[核心]** 负责肥力的计算、存储与动态恢复算法。 |
| **区块数据** | `ChunkFertilityData.java` | 定义区块肥力数据的结构（基础肥力、肥料类型、上次更新时间等）。 |
| **生长任务** | `GrowthTask.java` | 全局生长任务调度器 (注：当前主要逻辑已迁移至 `FarmingListener` 的主动 Tick)。 |
| **种植监听** | `FarmingListener.java` | **[核心]** 监听作物生长，实现基于肥力与基因的主动加速逻辑 (Active Ticking)。 |
| **视觉辅助** | `MonocleTask.java` | 负责“农夫单片镜”的射线检测与 ActionBar 数值显示。 |
| **物品管理** | `CuisineItemManager.java` | 管理自定义农具与肥料（如有机肥、化肥、单片镜、分析仪）。 |
| **指令系统** | `CuisineCommandExecutor.java` | 处理 `/getorganic`, `/getmonocle`, `/getanalyzer` 等基础指令。 |
| **基因核心** | `GeneticsManager.java` | **[核心]** 负责基因的序列化、杂交算法、突变逻辑与 PDC 存储。 |
| **基因数据** | `GeneData.java` | 定义单颗种子的完整基因组数据结构 (存储 6 对等位基因)。 |
| **等位基因** | `Allele.java` | 枚举基因类型 (A1-A4, a1-a4)，定义其强度数值与显示颜色。 |
| **性状定义** | `Trait.java` | 枚举作物性状 (生长势、结实量等)，负责数值到形容词的映射。 |
| **基因对** | `GenePair.java` | 封装一对等位基因，处理 **杂种优势 (Hybrid Vigor)** 的数值计算。 |
| **种子分析** | `SeedAnalyzerGUI.java` | 处理种子分析仪的 GUI 界面绘制、物品交互与数据展示逻辑。 |
| **分析仪监听** | `SeedAnalyzerListener.java` | 监听种子分析仪方块的放置与交互，打开 GUI 界面。 |
| **授粉系统** | `PollinationManager.java` | 处理花粉采集、人工授粉与花粉传播逻辑。 |
| **授粉监听** | `PollinationListener.java` | 监听花粉纸与作物的交互事件。 |
| **调试系统** | `DebugListener.java` | 处理调试棒 (Debug Stick) 的交互逻辑，支持多种调试模式切换。 |
| **调试指令** | `DebugCommandExecutor.java` | 处理 `/cfdebug` 等开发者指令，用于运行时修改数据。 |

---

## 3. 详细模块解析 (Detailed Module Analysis)

### 3.1 土地肥力系统 (`FertilityManager.java`)
该系统模拟了真实的土壤养分循环，由 **基础肥力 (Base Fertility)** 和 **肥料浓度 (Concentration)** 双轨驱动。

*   **基础肥力**: 
    *   范围: `-100` (极度贫瘠) ~ `100` (满肥) ~ `150` (超肥/有肥料加成)。
    *   **熵增消耗**: 肥力越高，作物吸收越快。消耗公式: `Cost = BaseCost * (1.0 + Fertility / 200.0)`。这意味着维持高肥力需要更多的投入。

*   **肥料浓度 (Concentration)**:
    *   这是土壤中当前活性养分的指标。
    *   **自然衰减**: 无论是否有作物，浓度都会以 **1.0/分钟** 的速度自然衰减 (在湿润耕地上)。
    *   **双刃剑机制**:
        *   **安全区 (0 - 100)**: 浓度越高，肥力恢复速度越快 (`K` 值提升)，且允许肥力上限突破至 `150`。
        *   **过量区 (100 - 200)**: 开始出现副作用，恢复速度提升收益递减。
        *   **剧毒区 (> 200)**: 烧苗效应。恢复速度大幅下降甚至变为负值（倒扣肥力），模拟施肥过量烧死作物。

### 3.2 生长干预系统 (核心机制)
插件彻底重构了原版的作物生长逻辑，实现了**动态 g 值计算**与**统一效率公式**，成为三大系统的核心枢纽。

#### 3.2.1 统一效率公式 (`Efficiency`)
所有外部系统（基因、BiomeGifts, EarthSpirit）的加成最终都汇总于此，计算出唯一的生长效率倍率：
> **Efficiency = 1.0 + Δ(Fertility) + Δ(Genes) + Δ(Biome) + Δ(Spirit)**

*   **基准值**: 1.0
*   **Δ(Fertility)**: 肥力修正。
    *   **普通作物**: `EffectiveFertility * 0.005` (范围 -0.5 ~ +0.5)。
    *   **基因作物**: **被耐肥性基因 (Resistance) 接管**。
        *   公式: `0.01 * Concentration * (1 - Concentration / (2 * Resistance))`
        *   范围: 取决于耐受值与浓度的匹配度，最高可达 `0.005 * Resistance`。
*   **Δ(Genes)**: 基因修正。
    *   主要由 **生长势 (Growth Vigor)** 基因提供。
    *   范围: `-0.5` (1星) ~ `+1.0` (5星)。
*   **Δ(Biome)**: 群系修正 (来自 **BiomeGifts**)。
    *   Rich: +0.3 (或其他配置值)
    *   Poor: -0.3 (或其他配置值)
*   **Δ(Spirit)**: 地灵修正 (来自 **EarthSpirit**)。
    *   范围: 0.0 ~ +1.0 (取决于地灵心情与等级)

#### 3.2.2 双向生长控制
根据最终计算出的 `Efficiency`，系统采取截然不同的处理策略：

1.  **减速/拦截 (`FarmingListener`)**:
    *   当 `Efficiency < 1.0` 时触发。
    *   计算失败概率 `P_fail = 1.0 - Efficiency`。
    *   若判定失败，**取消**原版生长事件 (`event.setCancelled(true)`)。
    *   *效果：作物生长变得极慢，模拟土地贫瘠或恶劣环境。*

2.  **主动生长系统 (`Active Growth System`)**:
    *   **核心机制**: 插件彻底抛弃了依赖原版 RandomTick 触发的被动加速模式，转而使用**主动式概率运算**。
    *   **智能注册表 (`Crop Registry`)**: 系统会自动追踪所有位于高肥力土地上的作物，将其纳入“加速名单”。
    *   **独立频率运算**: 
        *   不仅是增加单次生长的*幅度*，而是直接增加生长的*频率*。
        *   插件每 tick 都会对注册表中的作物进行独立判定，根据 `Efficiency` 计算额外的生长概率。
        *   **公式**: `P_extra = (Efficiency - 1.0) * P_vanilla`
    *   **优势**: 
        *   **极致丝滑**: 作物会在原版随机刻的间隙中自然生长，真正实现了“生长速度翻倍 = 生长频率翻倍”的视觉效果。
        *   **性能优异**: 得益于注册表机制，系统无需扫描全图，仅对有效作物进行 O(1) 级别的快速运算，即使万亩良田也能流畅运行。
        *   **抗压能力**: 完美支持 10000+ TickSpeed 的压力测试，概率算法在数学期望上与原版严格对齐。

#### 3.2.3 动态 g 值计算 (Vanilla-Aligned)
为了保证加速逻辑的科学性，插件完美复刻并动态计算了 Minecraft 原版作物生长积分 `g` (points)：
*   **公式**: `g = (1.0 + MoistureBonus + FarmlandBonus) / (Penalty + 1)`
    *   检测周围 8 格耕地是否湿润。
    *   检测同种作物是否相邻（同种惩罚）。
    *   检测对角线作物分布。
*   **概率转化**: `p = 1 / (floor(25 / g) + 1)`
*   *意义：这确保了我们的加速并非无脑 +1，而是严格遵循原版种植布局策略（如隔行种植最优解）。*

#### 3.2.4 骨粉机制 (Bone Meal Handling)
为了防止玩家利用原版骨粉机制绕过肥力消耗，系统对人工催熟进行了特殊处理：
*   **免除肥力消耗**: 
    *   玩家使用骨粉催熟作物时，**不消耗**任何土地肥力。
    *   收割带有“人工催熟”标记的作物时，也**不消耗**肥力。
    *   *目的：允许玩家低成本快速获取普通农作物（如刷小麦合成面包）。*
*   **特产掉落屏蔽**:
    *   凡是经过骨粉催熟（哪怕只是一次）的作物，收割时**绝对不会掉落**特产（如黄金麦穗）。
    *   *目的：稀有特产必须通过消耗肥力自然生长获得，确保经济平衡。*

### 3.3 农夫单片镜 (`MonocleTask.java`)
*   **物品**: `FARMER_MONOCLE` (基于铁头盔的自定义物品)。
*   **用法**: 装备在 **头盔槽** 位。
*   **效果**: 当准星对准耕地（距离10格内）时，ActionBar 实时显示 **土地肥力** 与 **肥料浓度** 双重数值。
*   **特性**: 支持 **视线穿透**，即使耕地上方有成熟作物，也能直接读取下方土壤数据。
*   **视觉反馈**:
    *   **土地肥力 (Left)**:
        *   **§6金色**: > 100 (溢出/极佳)
        *   **§a绿色**: 50 - 100 (良好)
        *   **§e黄色**: 0 - 50 (一般)
        *   **§c红色**: < 0 (贫瘠)
    *   **肥料浓度 (Right)**:
        *   **§4深红 (剧毒)**: > 200 (严重烧苗警告)
        *   **§c红色 (过量)**: > 100 (收益递减警告)
        *   **§e黄色 (活性)**: > 0 (正常生效中)
        *   **§7灰色 (无)**: 0 (需施肥)

### 3.4 肥料系统
目前实现了两种基础肥料，它们通过增加 **肥料浓度** 来生效：

1.  **有机肥料 (Organic Fertilizer)**: 
    *   **效果**: 浓度 **+20.0**。
    *   **特点**: 温和安全，适合日常维护。即便连用多次也不易突破安全阈值。
2.  **高效化肥 (Chemical Fertilizer)**: 
    *   **效果**: 浓度 **+50.0**。
    *   **特点**: 效果强劲，能迅速拉升肥力恢复速度。但需严格控制用量，连用 3 次即进入过量区，4 次即可能触发剧毒烧苗。

**交互优化**: 支持 **穿透施肥**。玩家可以直接对着作物右键使用肥料，系统会自动判定并作用于下方的耕地，无需先收割作物。

### 3.5 调试工具 (`DebugListener.java`)
*   **工具**: `STICK` (木棍)
*   **用法**: 手持木棍 **右键点击** 耕地或作物。
*   **定位**: 开发者与管理员专用的诊断工具，用于验证“统一效率公式”在各子系统间的执行准确性。
*   **显示面板**:
    1.  **核心计算**:
        *   显示系统最终采用的 **统一效率值 (Total Efficiency)**。
        *   显示反推出的 **基础肥力修正**，确保数据源头一致。
    2.  **环境参数 (Vanilla Mechanics)**:
        *   **g 值 (Points)**: 严格遵循原版算法的生长点数（受周围耕地、作物布局影响）。
        *   **p 值 (Probability)**: 当前 tick 下该作物的原版生长概率。
        *   *作用: 用于排查为何“肥力很高但长得慢”（通常是 g 值太低，如密植惩罚）。*
    3.  **子系统详情**:
        *   **基础肥力**: 显示当前肥力值、浓度值及对应的修正百分比。
        *   **地域环境 (Biome)**: 显示当前群系及 BiomeGifts 插件判定的富集/贫瘠状态。
        *   **地灵共鸣 (Spirit)**: 显示 EarthSpirit 地灵的激活状态、心情值与提供的额外加成。
    4.  **综合预估**:
        *   汇总所有加成，给出最终的 **生长效率总计 (Total Growth %)**。
        *   例如: `+80%` 意味着生长速度是原版的 1.8 倍。
    5.  **特产掉落预估**:
        *   显示当前的特产掉落总概率及构成（基础 + 肥力 + 地灵）。
        *   *注：CuisineFarming 不再直接处理掉落，而是提供数据供 BiomeGifts 统一计算。*

### 3.6 [融合架构] 统一基因系统 (Unified Genetics)
*(Status: Implemented - 已初步完成)*

本系统采用**“基因型驱动表型”**的架构，完美融合了“孟德尔遗传玩法”与“现有数值计算体系”。
*   **上游 (Genotype)**: 采用双等位基因存储数据，负责杂交、突变与遗传逻辑。
*   **下游 (Phenotype)**: 将基因型解析为具体数值（如生长速度倍率），供生长与肥力系统调用。

#### 3.6.1 基因型结构 (The Genotype)
每颗种子不再直接存储浮点数，而是存储一组**基因对 (Allele Pairs)**。
我们为作物定义了 6 大核心性状，每个性状对应一个特定的字母代号，采用更符合生物学的**物理/结构性描述**：

| 基因代号 | 性状名称 (Trait) | 描述 | 决定物理量 |
| :--- | :--- | :--- | :--- |
| **A** | **生长势** (Growth Vigor) | 影响作物发育速率 | **株高与分蘖速率** |
| **B** | **结实量** (Yield) | 影响果实数量与密度 | **穗粒结构与果实密度** |
| **C** | **表皮结构** (Epidermal) | 决定对极端温度的耐受力 | **角质层厚度与气孔密度** |
| **D** | **根系发达度** (Root) | 决定对高浓度肥料的耐受力 | **根冠比与侧根生物量** |
| **E** | **伴生性状** (Luck) | 影响伴生特产的发现率 | **共生菌群与特殊代谢产物** |
| **F** | **营养质地** (Texture) | 影响食材的微观品质 | **干物质积累与纤维含量** |

**等位基因 (Alleles)**:
*   基因分为显性（大写）与隐性（小写），数值代表强度。
*   **正向基因**: `A1`, `A2`, `A3` (强度递增，显示为绿色/金色)。
*   **负向基因**: `a1`, `a2`, `a3` (强度递增，显示为红色/深红)。
*   **传说基因**: **`A4`** (光辉色 `§d`) 与 **`a4`** (虚空色 `§0`)，仅能通过突变获取。
*   **默认基因**: 所有野生种子的默认基因为 **A1a1** (及对应其他字母)，代表一种微妙的平衡状态。

#### 3.6.2 表型解析规则 (Phenotype Mapping)
系统在运行时通过 `getGene(Trait)` 动态计算数值。特别引入了 **杂种优势 (Hybrid Vigor)** 机制：
*   **纯合子 (Homozygous)**: 如 `A3A3`，数值直接相加 (`3+3=6`)。
*   **杂合子 (Heterozygous)**: 如 `A4A3` (显性杂合)，数值相加后乘以 **2.0倍** (`(4+3)*2.0=14`)。
*   *设计意图：最高的数值并不来自最纯的基因（A4A4=8），而是来自最强的显性杂交组合（A4A3=14）。鼓励玩家收集不同种类的优质基因并进行杂交，而非单一维度的提纯。*
*   *(注：普通的杂交如 A3a1 得分为 (3-1)*2 = 4，虽然有加成但仍弱于 A3A3，因此玩家需追求“双强杂交”。)*

**1. 生长势 (Trait A)**
*   **数值范围**: `-1.4` ~ `+1.4` (映射自基因总分，Max=14)。
*   **效果**: 直接作为 `Δ(Genes)` 加成到生长效率公式中。
*   *例*: `A4A3` (14分) -> `+1.4` 效率 (神速); `A3A3` (6分) -> `+0.6` 效率。

**2. 结实量 (Trait B)**
*   **机制**: **线性倍率加成 (Linear Multiplier)**。
*   **公式**: `Multiplier = 1.0 + (Score / 10.0)` (仅当 Score > 0 时生效)。
*   **效果**: 
    *   该倍率不仅影响原版作物掉落，还通过 API 影响 **“地域馈赠” (Region Gifts)** 插件的特产掉落率。
    *   **区间**:
        *   `Score <= 0`: **1.0x** (无加成)。
        *   `Score = 5`: **1.5x** (50% 额外掉落概率)。
        *   `Score = 10`: **2.0x** (100% 额外掉落概率 / 翻倍)。
        *   `Score = 14`: **2.4x** (140% 额外掉落概率 / 传说级丰收)。

**3. 根系发达度 (Trait D) - 耐肥性**
*   **对应旧版**: Fertility Resistance。
*   **公式**: `Bonus = 0.01 * Concentration * (1 - Concentration / (2 * Resistance))`
*   **效果**: 决定作物在高浓度肥料下的生存能力与吸收效率。
*   *传说基因 (A4A3)* 能提供高达 `560` 的 `Resistance`，允许作物在极其致死的化肥浓度下依然保持最大收益 (+280% 效率)。

**4. 表皮结构 (Trait C) - 温度适应**
*   **机制**: **动态效率修正**。
*   **基准**: 以平原生物群系温度 (0.8) 为基准。
*   **惩罚**: 环境温度每偏离基准 1.0，基础效率降低 0.5 (即 -50%)。
*   **基因修正**:
    *   正向基因 (如“厚皮”) 提供正修正，抵消环境惩罚。
    *   负向基因 (如“薄皮”) 提供负修正，加剧环境敏感度。
    *   公式: `Bonus = Score / 20.0`。
    *   *例*: `A4A3` (14分) 提供 `+0.7` 修正，足以完全抵消地狱 (Nether) 环境的温度惩罚 (`-0.6`) 并提供额外加速。

#### 3.6.3 收获与自交逻辑 (Harvest & Self-Pollination)
为了模拟真实的生物学遗传变异，系统在作物收获时执行**逐粒种子独立计算**的策略：

1.  **独立遗传**: 
    *   当作物掉落多个种子时，每一个种子都会进行一次独立的遗传判定。
    *   这意味着即使是同一株作物掉落的 3 颗种子，其基因组合也可能完全不同（由于配子分离与随机突变）。
2.  **自交 (Self-Pollination)**:
    *   如果没有外源花粉（未进行人工授粉），作物将进行**自交**。
    *   自交等同于父本与母本均为该作物本身，通过孟德尔遗传算法重新组合等位基因。
    *   *结果*: 杂合子作物（如 `Aa`）自交后会发生性状分离（`AA`, `Aa`, `aa`），导致后代性状不稳定；而纯合子作物（如 `AA`）自交后代则相对稳定。

#### 3.6.4 突变与重组 (Mutation & Recombination)
*(New 2025-12-23)*

**1. 基因重组 (Recombination)**
*   **定义**: 就像洗牌一样。父母双方的基因库是固定的，通过杂交（洗牌），将现有的牌重新组合，产生新的手牌（基因型）。
*   **玩法**: 这是玩家通过杂交获得优良性状的主要手段。例如，通过 `A1A1` 和 `A2A2` 杂交，可能重组出 `A1A2` 这种带有杂种优势的强力组合。

**2. 基因突变机制 (Mutation Mechanism)**
你可能会好奇，突变到底是怎么发生的？系统采用了**“逐个等位基因判定” (Per-Allele Check)** 的深度模拟机制。
*   **流程**: 
    *   当一颗种子生成时，系统会遍历该作物的所有性状。
    *   对于每一个性状的一对等位基因（如 `A` 和 `a`），系统会**分别**进行判定。
    *   这意味着一次杂交中，可能父本提供的基因发生了突变，而母本的没有；或者运气极好，两者都发生了突变。
*   **阶位跳变 (Step Mutation)**:
    *   突变并非完全随机生成一个新数值，而是基于原有数值进行**“阶位跳变”**。
    *   **进化 (Up)**: `a4` -> `a3` -> `a2` -> `a1` -> `A1` -> `A2` -> `A3` -> **`A4`**
    *   **退化 (Down)**: **`A4`** -> `A3` -> `A2` -> `A1` -> `a1` -> `a2` -> `a3` -> `a4`
    *   这是一个 50% / 50% 的机会。这意味着突变充满了风险：你珍贵的 `A3` 基因可能因为一次辐射而退化为 `A2`，但也可能飞升为传说中的 `A4`。

**3. 传说基因 (The Mythical Tier - A4)**
为了提升突变的含金量，系统引入了**无法自然生成**的传说级基因 —— **A4**。
*   **获取途径**: 唯有通过**基因突变**。你必须持有 `A3` 级的强力种子，在极端的环境下（如末地高空）进行反复杂交，祈祷那 1.6% 的奇迹发生。
*   **强度**: 
    *   单体强度: **+4**。
    *   **最强组合**: `A4` + `A3` (杂合子) = `(4+3)*2.0` = **14分** (效率 +140%)。
    *   *注: 这比之前的理论极限 (A3+A2=10分) 提升了 40%，是追求极致农业的终极目标。*

**4. 环境诱变 (Environmental Factors)**
*   **基础概率**: 0.1% (自然背景辐射)。
*   **高空辐射**: 种植在世界极限高度 (主世界 Y>=310 或 末地 Y>=250)，突变率 **+1.0%**。
*   **混沌环境**: 在 **蘑菇岛 (Mushroom Fields)** 或 **末地 (The End)** 种植，突变率 **+0.5%**。

#### 3.6.5 初始基因分布 (Wild Seed Distribution)
当玩家获得一颗野生种子（或通过指令生成）时，其基因并非完全随机，而是遵循一套严谨的 **正态分布模拟算法**。这确保了生态的平衡，同时保留了“由于随机性带来的惊喜”。

| 档位 (Tier) | 概率 | 描述 | 基因型示例 | 评分贡献 |
| :--- | :--- | :--- | :--- | :--- |
| **普通 (Ordinary)** | **60%** | 平平无奇，无优缺点 | `A1` + `a1` | **0** |
| **轻微偏差 (Mild)** | **20%** | 有一点点特长或缺陷 | `A1`+`A1` (+2) 或 `a1`+`a1` (-2) | **±1 ~ ±2** |
| **显著偏差 (Significant)** | **15%** | 明显的优良或劣质品种 | `A2`+`A1` (+3) 或 `a2`+`a1` (-3) | **±3 ~ ±4** |
| **极端突变 (Extreme)** | **5%** | 极罕见的天选或天谴之子 | `A3`+`A3` (+6) 或 `a3`+`a3` (-6) | **±5 ~ ±6** |

*   **设计哲学**: 
    *   绝大多数种子（60%）都是普通的，这意味着玩家必须通过选育才能获得良种。
    *   `A4` 基因**绝对不会**出现在野生种子中，保证了其稀有度与通过突变获取的成就感。

#### 3.6.6 种子状态与鉴定
*   **未鉴定 (Unidentified)**: 种子物品上无详细 Lore。
*   **已鉴定 (Identified)**: 
    *   **显示格式**: `性状名: [基因1, 基因2] (评价)`
    *   **示例**:
        *   `生长势: [A1, a1] (普通的)` -> 默认状态
        *   `结实量: [B3, B3] (炸裂的)` -> 极品纯合子
        *   `根系发达度: [d2, d2] (瘦弱的)` -> 劣质纯合子

---

### 3.7 朴素生物学：种子鉴定与命名 (Rustic Genetics)
*(Status: Implemented - 已实装)*

#### 3.7.1 基因命名法 (Nomenclature)
种子在未进行详细鉴定（Seed Analyzer）之前，玩家只能通过其**外在表现**（即基因分数的绝对值）来模糊判断其特性。系统会自动根据种子最显著的性状为其命名。

*   **平平无奇的 (Ordinary)**:
    *   所有性状的基因分绝对值均 **< 3.0**。
    *   显示名称: `平平无奇的 [作物名]种子`。
    *   Lore: `(平平无奇)`。

*   **显著特征 (Significant Traits)**:
    *   任意性状的基因分绝对值 **>= 3.0**。
    *   **命名规则**: 取绝对值最大的性状对应的形容词作为前缀。
    *   **Lore 规则**: 以标签形式列出所有绝对值 >= 3.0 的性状。
    *   *例*: 一个同时具有 `生长势: 6.0 (躁动)` 和 `结实量: -4.0 (轻飘)` 的种子。
        *   名称: `躁动的 小麦种子` (取最大值 6.0)。
        *   Lore: `特征: §6[躁动] §c[轻飘]`。

#### 3.7.2 性状形容词表 (Adjective Table)
不同分数的基因表现对应不同的形容词，颜色代表强度。

**分级标准 (Tiers):**
*   **Tier 1 (3.0 - 4.9)**: 正向 `§a` (Green), 负向 `§c` (Red)
*   **Tier 2 (5.0 - 7.9)**: 正向 `§b` (Aqua), 负向 `§4` (Dark Red)
*   **Tier 3 (8.0 - 10.9)**: 正向 `§6` (Gold), 负向 `§5` (Dark Purple)
*   **Tier 4 (11.0+)**: 正向 `§d` (Light Purple), 负向 `§8` (Dark Gray)

**形容词对照:**

| 性状 (Trait) | 符号 | 正向 (+) (T1 / T2 / T3 / T4) | 负向 (-) (T1 / T2 / T3 / T4) |
| :--- | :---: | :--- | :--- |
| **生长势** | A | **萌动** / **活力** / **躁动** / **疯长** | **慵懒** / **沉睡** / **僵硬** / **石化** |
| **结实量** | B | **饱满** / **沉重** / **满溢** / **炸裂** | **轻飘** / **干瘪** / **空心** / **尘埃** |
| **表皮结构** | C | **厚皮** / **粗糙** / **绒毛** / **披甲** | **薄皮** / **娇嫩** / **剔透** / **气泡** |
| **根系发达度** | D | **壮实** / **黝黑** / **贪吃** / **暴食** | **瘦弱** / **苍白** / **敏感** / **焦黑** |
| **伴生性状** | E | **光洁** / **晶莹** / **金边** / **虹光** | **灰暗** / **斑驳** / **霉斑** / **漆黑** |
| **营养质地** | F | **清香** / **蜜渍** / **溢香** / **发光** | **生涩** / **发苦** / **腥臭** / **腐烂** |

### 3.8 授粉系统 (Pollination System)
*(New 2025-12-23)*

本系统允许玩家进行跨植株的人工授粉，是定向培育优良品种的关键手段。

*   **物品**: `POLLEN_PAPER` (花粉纸)
*   **采集花粉**:
    *   手持 **纸 (Paper)** 右键点击 **已鉴定** 的成熟作物。
    *   消耗一张纸，获得一张 **花粉纸**，记录了该父本的完整基因信息。
    *   *限制*: 只能采集已鉴定作物的花粉。未知基因无法用于育种。
*   **人工授粉**:
    *   手持 **花粉纸** 右键点击另一株作物（母本）。
    *   消耗花粉纸，母本被成功授粉（显示快乐村民粒子特效）。
    *   *效果*: 该母本收割时掉落的种子，将强制使用 **花粉基因 (父本)** 与 **自身基因 (母本)** 进行杂交计算，而非默认的自交。

### 3.9 种子分析仪 (Seed Analyzer)
*(New 2025-12-23)*

所有自然掉落的种子默认均为 **未鉴定 (Unidentified)** 状态，无法查看详细基因数据，也无法用于采集花粉。必须使用分析仪解锁基因图谱。

*   **机器**: `SEED_ANALYZER` (种子分析仪)
    *   外观: 铁块材质的自定义方块。
    *   获取: `/getanalyzer` (管理员) 或 合成 (待定)。
*   **使用流程**:
    1.  放置分析仪并右键打开 GUI。
    2.  在左侧插槽放入 **未鉴定种子**。
    3.  点击中间的 **绿色按钮** 开始分析。
    4.  等待分析完成（模拟运算过程）。
    5.  从右侧插槽取出 **已鉴定种子**。
*   **鉴定结果**:
    *   鉴定后的种子将在 Lore 中清晰展示 **6 对等位基因** 的详细构成。
    *   同时显示各项性状的 **最终评分** 与 **等级评价** (如 "§d传说 [Mythical]")。

### 3.10 沉浸式烹饪系统 (Immersive Cooking)
*(New 2025-12-24)*

该系统将传统的“工作台合成”转变为**物理交互与温控 QTE** 的沉浸式体验。玩家需要操作铁锅、控制火候，并利用高品质食材烹饪出带有 Buff 的星级美食。

**1. 核心技术架构 (Core Architecture)**
*   **状态机驱动 (State Machine)**:
    *   **IDLE (空闲)**: 只有环境温度，无食材。
    *   **PREPARING (备料)**: 放入食材但未加热至沸腾。此时温度条显示灰色/白色。
    *   **COOKING (烹饪)**: 温度达标且匹配食谱（或强制开启），进入锁定状态。开始 QTE 计分。
    *   **FINISHED (完成)**: 烹饪结束，生成成品并播放音效/粒子。
    *   **BURNT (糊锅)**: 状态异常或系统强制中断。
*   **标签系统 (Food Tags)**:
    *   摒弃传统的“物品对物品”合成，采用 **Tag-Based** 模糊匹配。
    *   例如 `stew_recipe` 需求 `MEAT x2 + VEGGIE x1`，玩家可以使用牛肉+胡萝卜，也可以用羊肉+马铃薯。
    *   支持 **NBT/PDC 数据透传**：食材的星级数据会被提取并加权计算到成品中。

**2. 物理交互与 GUI (Interaction)**
*   **设备**: `CAULDRON` (炼药锅)。下方需有热源（火/岩浆块/营火）。
*   **操作**:
    *   **投入食材**: 直接将物品丢入 (Drop) 或右键点击锅具。
    *   **打开界面**: 右键点击锅具打开 **54格大容量烹饪界面**。
        *   **输入区**: 左侧 2x3 矩阵 (Slot 10,11,19,20,28,29)。
        *   **输出区**: 右侧独立槽位 (Slot 25)。
        *   **燃料区**: 底部槽位 (Slot 40)。
    *   **视觉反馈**: 食材会以 `ItemDisplay` 形式在锅内真实悬浮、旋转与烹煮。

**3. 温控 QTE 机制 (Thermodynamics)**
烹饪不再是瞬间完成，而是一场对**温度**的精准把控游戏。
*   **升温**: 下方热源提供基础热量。使用 **蒲扇 (Hand Fan)** 右键可短时大幅升温。
*   **降温**: 使用 **木汤勺 (Wooden Ladle)** 搅拌或直接倒入 **水/冰** 可降温。
*   **自适应 UI (Adaptive UI)**:
    *   锅具上方的 **悬浮温度条 (TextDisplay)** 会根据当前识别到的食谱**动态变色**。
    *   **绿色区间**: 对应当前菜谱的“最佳温区”（如炖肉 80-150°C，海鲜 120-200°C）。
    *   **QTE 目标**: 玩家需通过添柴/扇风/加水，使温度始终保持在绿色区间内。

**4. 品质结算与黑暗料理 (Result Calculation)**
最终成品的品质由**食材品质**与**厨艺 (QTE)** 共同决定。
*   **公式**: `FinalStars = (食材平均星级 * 50%) + (QTE评分 * 50%)`
    *   **QTE评分**: 温度停留在最佳温区的时间比例 (0% - 100%)。
*   **结果分支**:
    *   **完美料理**: 获得带有 PDC 星级数据的美味佳肴，食用可获得强力 Buff。
    *   **黑暗料理 (Mystery Stew)**: 
        *   触发条件：放入了无法匹配任何食谱的食材组合（如 泥土+牛肉），强行搅拌烹饪。
        *   惩罚机制：烹饪结束后，锅内**每种食材扣除 1 个**，并产出一碗带有反胃效果的黑暗料理。

---

## 4. 指令与权限 (Commands & Permissions)

| 指令 | 权限 | 描述 |
| :--- | :--- | :--- |
| `/getmonocle` | `cuisinefarming.get` | 获取农夫单片镜（查看肥力用）。 |
| `/getanalyzer` | `cuisinefarming.get` | 获取种子分析仪（鉴定种子用）。 |
| `/getorganic` | `cuisinefarming.get` | 获取有机肥料。 |
| `/getchemical` | `cuisinefarming.get` | 获取高效化肥。 |

---

## 5. 开发进度与计划 (Development Status)

### 已实现 (Implemented)
- [x] **数据层**: 基于 PDC 的区块肥力与基因数据存储。
- [x] **核心算法**: 湿润耕地的动态肥力恢复与倒U型耐肥收益曲线。
- [x] **生长控制**: 基于肥力与基因的主动式作物生长干预（Active Growth）。
- [x] **交互工具**: 农夫单片镜 (视觉反馈)、肥料 (有机/化肥)。
- [x] **基因基础**: 种子分析仪、未鉴定/已鉴定种子区分、NBT存储。
- [x] **杂交流程**: 手工花粉采集、人工授粉、收割时子代基因计算与遗传。
- [x] **烹饪系统**: 铁锅物理交互、温控QTE小游戏、配方判定与成品星级结算。

### 待实现 (Pending)
*(基于 `TECH_DESIGN_DOC.md` 的差距分析)*
- [ ] **视觉层**: 耕地材质随肥力动态变化 (ItemsAdder/Oraxen)。
- [ ] **自动化杂交**: 
    - 文档设计了 **授粉架 (Pollination Rack)** 以连接两块耕地实现自动杂交。
    - 目前仅实现了手工授粉，需评估是否仍需开发授粉架以支持自动化农业。
- [ ] **种子提纯 (Purification)**:
    - 文档提及“在优秀环境下种植积累生长势以产出高星种子”。
    - 目前仅能通过杂交突变提升数值，缺乏单一种植提升路径。
- [ ] **温室系统**: 
    - 需实现玻璃判定与微气候温度计算 (目前直接读取生物群系温度)。
    - [x] 基因中的温度适应性 (Trait C) 已接入环境温度判定。


---

**文档维护人**: 开发组
**最后更新**: 2025-12-24
